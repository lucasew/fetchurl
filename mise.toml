[tools]
go = "1.24.3"
"go:golang.org/x/tools/gopls" = "latest"
golangci-lint = "1.64.6"
actionlint = "1.7.7"
node = "22.14.0"
sqlc = "1.30.0"

[tasks."lint:go"]
run = "golangci-lint run ./..."
description = "Lint Go code"

[tasks."lint:md"]
run = "npx markdownlint-cli2 \"**/*.md\" \"#node_modules\""
description = "Lint Markdown files"

[tasks."lint:actions"]
run = "actionlint"
description = "Lint GitHub Actions workflows"

[tasks.lint]
depends = ["lint:*"]
description = "Run all linters"

[tasks."fmt:go"]
run = "go fmt ./..."
description = "Format Go code"

[tasks.fmt]
depends = ["fmt:*"]
description = "Format all code"

[tasks.test]
run = "go test -v ./..."
description = "Run tests"

[tasks."test:integration"]
run = """
if [ "$CI" = "true" ]; then
  go test -v -tags integration ./test/integration/...
else
  echo "Skipping integration tests locally (CI env var not set)"
fi
"""
description = "Run integration tests (CI only)"

[tasks.codegen]
run = "sqlc generate"
description = "Generate code (SQLC)"

[tasks.install]
run = "go mod download"
description = "Install dependencies"

[tasks.build]
run = "go build -o fetchurl ./cmd/fetchurl"
description = "Build the binary"

[tasks.ci]
depends = ["lint", "test", "test:integration"]
description = "Run CI pipeline"
